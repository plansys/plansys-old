
/** 
 * https://github.com/angular-ui/ui-layout v1.4.2 
 * Modified by rizky 3 sept 2016 - comment uncollapsedSize -
 */
"use strict";angular.module("ui.layout",[]).controller("uiLayoutCtrl",["$scope","$attrs","$element","$timeout","$window","LayoutContainer","Layout",function(e,n,i,t,o,a,s){function r(){var n=p.sizeProperties.flowProperty,o=parseInt(f.dividerSize),a=i[0][p.sizeProperties.offsetSize];if(null!==p.movingSplitbar){var s=p.containers.indexOf(p.movingSplitbar),r=s+2<p.containers.length?s+2:null;if(s>-1){var l=p.processSplitbar(p.containers[s]),u=l.beforeContainer,m=l.afterContainer;if(!u.collapsed&&!m.collapsed){var z=p.movingSplitbar[n]-d,y=p.movingSplitbar[n]-z;y=Math.min(a-o,y),angular.isNumber(u.beforeMinValue)&&y<u.beforeMinValue&&(y=u.beforeMinValue),angular.isNumber(u.beforeMaxValue)&&y>u.beforeMaxValue&&(y=u.beforeMaxValue),null!==m&&angular.isNumber(m.afterMinValue)&&y>m.afterMinValue-o&&(y=m.afterMinValue-o),null!==m&&angular.isNumber(m.afterMaxValue)&&y<m.afterMaxValue&&(y=m.afterMaxValue),u.size=y-u[n];var v=m[n];m[n]=y+o,m[n]!=v&&(m.size=null!==r?v+m.size-(y+o):a-(y+o)),p.movingSplitbar[n]=y,g&&t.cancel(g),g=t(function(){e.$broadcast("ui.layout.resize",u,m),g=null},50)}}}c=null}function l(e){var n=e[0],i=document.documentElement||document.body,t=window.pageXOffset||i.scrollLeft,o=window.pageYOffset||i.scrollTop,a=n.getBoundingClientRect(),s=a.left+t,r=a.top+o;return{left:s,top:r}}function u(e){return"number"==typeof e||"string"==typeof e&&e.match(z)?e:null}var c,d,p=this,f=angular.extend({},e.$eval(n.uiLayout),e.$eval(n.options)),m=0,z=/\d+\s*(px|%)\s*$/i;s.addLayout(p),p.containers=[],p.movingSplitbar=null,p.bounds=i[0].getBoundingClientRect(),p.isUsingColumnFlow="column"===f.flow,p.sizeProperties=p.isUsingColumnFlow?{sizeProperty:"width",offsetSize:"offsetWidth",offsetPos:"left",flowProperty:"left",oppositeFlowProperty:"right",mouseProperty:"clientX",flowPropertyPosition:"x"}:{sizeProperty:"height",offsetSize:"offsetHeight",offsetPos:"top",flowProperty:"top",oppositeFlowProperty:"bottom",mouseProperty:"clientY",flowPropertyPosition:"y"},i.addClass("stretch").addClass("ui-layout-"+(f.flow||"row")),f.disableToggle&&i.addClass("no-toggle"),f.disableMobileToggle&&i.addClass("no-mobile-toggle"),f.sizes=f.sizes||[],f.maxSizes=f.maxSizes||[],f.minSizes=f.minSizes||[],f.dividerSize=void 0===f.dividerSize?10:f.dividerSize,f.collapsed=f.collapsed||[],p.opts=f,e.updateDisplay=function(){p.calculate()};var g;return p.mouseUpHandler=function(e){return null!==p.movingSplitbar&&(p.movingSplitbar=null),e},p.mouseMoveHandler=function(e){var n=e[p.sizeProperties.mouseProperty]||e.originalEvent&&e.originalEvent[p.sizeProperties.mouseProperty]||(o.jQuery?e.originalEvent?e.originalEvent.targetTouches[0][p.sizeProperties.mouseProperty]:0:e.targetTouches?e.targetTouches[0][p.sizeProperties.mouseProperty]:0);d=n-l(i)[p.sizeProperties.offsetPos],c&&window.cancelAnimationFrame(c),c=window.requestAnimationFrame(r)},p.processSplitbar=function(e){var n=p.containers.indexOf(e),i=function(e){var n=e[p.sizeProperties.flowProperty],i=e[p.sizeProperties.flowProperty]+e.size;e.beforeMinValue=angular.isNumber(e.minSize)?n+e.minSize:n,e.beforeMaxValue=angular.isNumber(e.maxSize)?n+e.maxSize:null,e.afterMinValue=angular.isNumber(e.minSize)?i-e.minSize:i,e.afterMaxValue=angular.isNumber(e.maxSize)?i-e.maxSize:null};if(n>-1){var t=n>0?p.containers[n-1]:null,o=n+1<=p.containers.length?p.containers[n+1]:null;return null!==t&&i(t),null!==o&&i(o),{beforeContainer:t,afterContainer:o}}return null},p.isPercent=function(e){return!!(e&&angular.isString(e)&&e.indexOf("%")>-1)},p.convertToPixels=function(e,n){return Math.floor(n*(parseInt(e)/100))},p.calculate=function(){var e,n,t=parseInt(f.dividerSize),o=i[0].getBoundingClientRect()[p.sizeProperties.sizeProperty],s=o-t*m,r=s,l=0,c=0;if(p.containers.length>0&&i.children().length>0){for(n=0;n<p.containers.length;n++)a.isSplitbar(p.containers[n])||(e=p.containers[n],f.sizes[n]=e.isCentral?"auto":e.collapsed?u(e.minSize)||"0px":u(e.uncollapsedSize)||"auto",f.minSizes[n]=u(e.minSize),f.maxSizes[n]=u(e.maxSize),"auto"!==f.sizes[n]&&(p.isPercent(f.sizes[n])?f.sizes[n]=p.convertToPixels(f.sizes[n],r):f.sizes[n]=parseInt(f.sizes[n])),null!==f.minSizes[n]&&(p.isPercent(f.minSizes[n])?f.minSizes[n]=p.convertToPixels(f.minSizes[n],r):f.minSizes[n]=parseInt(f.minSizes[n]),!e.collapsed&&f.sizes[n]<f.minSizes[n]&&(f.sizes[n]=f.minSizes[n])),null!==f.maxSizes[n]&&(p.isPercent(f.maxSizes[n])?f.maxSizes[n]=p.convertToPixels(f.maxSizes[n],r):f.maxSizes[n]=parseInt(f.maxSizes[n]),f.sizes[n]>f.maxSizes[n]&&(f.sizes[n]=f.maxSizes[n])),"auto"===f.sizes[n]?c++:s-=f.sizes[n]);var d=Math.floor(s/c),z=s-d*c;for(n=0;n<p.containers.length;n++){if(e=p.containers[n],e[p.sizeProperties.flowProperty]=l,e.maxSize=f.maxSizes[n],e.minSize=f.minSizes[n],a.isSplitbar(e))e.size=t;else{var g;"auto"===f.sizes[n]?(g=d,z>0&&n===p.containers.length-1&&(g+=z)):g=f.sizes[n],e.size=null!==g?g:d}l+=e.size}}},p.addContainer=function(e){var n=p.indexOfElement(e.element);return!angular.isDefined(n)||0>n||p.containers.length<n?void console.error("Invalid index to add container; i="+n+", len=",p.containers.length):(a.isSplitbar(e)&&m++,e.index=n,p.containers.splice(n,0,e),void p.calculate())},p.removeContainer=function(e){var n=p.containers.indexOf(e);if(n>=0){a.isSplitbar(e)?(p.containers[n-1].collapsed=!1,m--):p.containers.length>2&&(n==p.containers.length-1?p.containers[n-1].element.remove():p.containers[n+1].element.remove());var i=p.containers.indexOf(e);i>=0&&(p.containers.splice(i,1),p.opts.maxSizes.splice(i,1),p.opts.minSizes.splice(i,1),p.opts.sizes.splice(i,1)),p.calculate()}else console.error("removeContainer for container that did not exist!")},p.getContainers=function(){return p.containers},p.toggleContainer=function(e){var n,i=p.containers[e+1];i?n=i.element[0].children[0]:(i=p.containers[e-1],n=i.element[0].children[1]),t(function(){angular.element(n).triggerHandler("click")})},p.toggleBefore=function(n){var i=p.containers.indexOf(n)-1,t=p.containers[i];t.collapsed=!p.containers[i].collapsed;var o=p.containers[i+1],a=p.containers[i+2];return void 0===t.uncollapsedSize&&(t.uncollapsedSize=t.size),e.$apply(function(){t.collapsed?(t.size=0,o&&(o[p.sizeProperties.flowProperty]-=t.uncollapsedSize),a&&(a[p.sizeProperties.flowProperty]-=t.uncollapsedSize)):(t.size=t.uncollapsedSize,o&&(o[p.sizeProperties.flowProperty]+=t.uncollapsedSize),a&&(a[p.sizeProperties.flowProperty]+=t.uncollapsedSize))}),e.$broadcast("ui.layout.toggle",t),s.toggled(),t.collapsed},p.toggleAfter=function(n){var t,o=p.containers.indexOf(n)+1,a=p.containers[o],r=p.containers[o-1],l=p.containers[o-2],u=o===p.containers.length-1,c=p.sizeProperties.flowProperty,d=p.sizeProperties.sizeProperty;return p.bounds=i[0].getBoundingClientRect(),a.collapsed=!p.containers[o].collapsed,void 0===a.uncollapsedSize&&(a.uncollapsedSize=a.size),e.$apply(function(){a.collapsed?(a.size=0,t=u?p.bounds[d]-a[c]-a.uncollapsedSize:0,r&&(r[c]+=a.uncollapsedSize+t),l&&(l.size+=a.uncollapsedSize+t)):(a.size=a.uncollapsedSize,t=u?p.bounds[d]-a[c]-a.uncollapsedSize:0,r&&(r[c]-=a.uncollapsedSize+t),l&&(l.size-=a.uncollapsedSize+t))}),e.$broadcast("ui.layout.toggle",a),s.toggled(),a.collapsed},p.getPreviousSplitbarContainer=function(e){if(a.isSplitbar(e)){var n=p.containers.indexOf(e),i=n-2;return i>=0?p.containers[i]:null}return null},p.getNextSplitbarContainer=function(e){if(a.isSplitbar(e)){var n=p.containers.indexOf(e),i=n+2;return n>0&&i<p.containers.length?p.containers[i]:null}return null},p.hasSplitbarBefore=function(e){var n=p.containers.indexOf(e);return n>=1?a.isSplitbar(p.containers[n-1]):!1},p.hasSplitbarAfter=function(e){var n=p.containers.indexOf(e);return n<p.containers.length-1?a.isSplitbar(p.containers[n+1]):!1},p.isLayoutElement=function(e){return e.hasAttribute("ui-layout-container")||e.hasAttribute("ui-splitbar")||"UI-LAYOUT-CONTAINER"===e.nodeName},p.indexOfElement=function(e){for(var n=e.parent(),i=n.children(),t=0,o=0;o<i.length;o++){var a=i[o];if(p.isLayoutElement(a)){if(e[0]==i[o])return t;t++}}return-1},p}]).directive("uiLayout",["$window",function(e){return{restrict:"AE",controller:"uiLayoutCtrl",link:function(n,i,t,o){function a(){n.$evalAsync(function(){o.calculate()})}n.$watch(function(){return i[0][o.sizeProperties.offsetSize]},function(){o.calculate()}),angular.element(e).bind("resize",a),n.$on("$destroy",function(){angular.element(e).unbind("resize",a)})}}}]).directive("uiSplitbar",["LayoutContainer",function(e){var n=angular.element(document.body.parentElement);return{restrict:"EAC",require:"^uiLayout",scope:{},link:function(i,t,o,a){t.hasClass("stretch")||t.addClass("stretch"),t.hasClass("ui-splitbar")||t.addClass("ui-splitbar");var s=a.isUsingColumnFlow?"animate-column":"animate-row";t.addClass(s),i.splitbar=e.Splitbar(),i.splitbar.element=t;var r=angular.element(t.children()[0]),l=angular.element(t.children()[1]),u=angular.element(r.children()[0]),c=angular.element(l.children()[0]),d="ui-splitbar-icon-left",p="ui-splitbar-icon-right",f="ui-splitbar-icon-up",m="ui-splitbar-icon-down",z=a.isUsingColumnFlow?d:f,g=a.isUsingColumnFlow?p:m;u.addClass(z),c.addClass(g),r.on("click",function(){var e,n,t=a.toggleBefore(i.splitbar),o=a.getPreviousSplitbarContainer(i.splitbar);null!==o&&(e=angular.element(o.element.children()[0]),n=angular.element(o.element.children()[1])),a.isUsingColumnFlow?t?(l.css("display","none"),u.removeClass(d),u.addClass(p),null!==o&&(e.css("display","none"),n.css("display","none"))):(l.css("display","inline"),u.removeClass(p),u.addClass(d),null!==o&&(e.css("display","inline"),n.css("display","inline"))):t?(l.css("display","none"),u.removeClass(f),u.addClass(m),null!==o&&(e.css("display","none"),n.css("display","none"))):(l.css("display","inline"),u.removeClass(m),u.addClass(f),null!==o&&(e.css("display","inline"),n.css("display","inline"))),i.$evalAsync(function(){a.calculate()})}),l.on("click",function(){var e,n,t=a.toggleAfter(i.splitbar),o=a.getNextSplitbarContainer(i.splitbar);null!==o&&(e=angular.element(o.element.children()[0]),n=angular.element(o.element.children()[1])),a.isUsingColumnFlow?t?(r.css("display","none"),c.removeClass(p),c.addClass(d),null!==o&&(e.css("display","none"),n.css("display","none"))):(r.css("display","inline"),c.removeClass(d),c.addClass(p),null!==o&&(e.css("display","inline"),n.css("display","inline"))):t?(r.css("display","none"),c.removeClass(m),c.addClass(f),null!==o&&(e.css("display","none"),n.css("display","none"))):(r.css("display","inline"),c.removeClass(f),c.addClass(m),null!==o&&(e.css("display","inline"),n.css("display","inline"))),i.$evalAsync(function(){a.calculate()})}),t.on("mousedown touchstart",function(e){return a.movingSplitbar=i.splitbar,a.processSplitbar(i.splitbar),e.preventDefault(),e.stopPropagation(),n.on("mousemove touchmove",function(e){i.$apply(angular.bind(a,a.mouseMoveHandler,e))}),!1}),n.on("mouseup touchend",function(e){i.$apply(angular.bind(a,a.mouseUpHandler,e)),n.off("mousemove touchmove")}),i.$watch("splitbar.size",function(e){t.css(a.sizeProperties.sizeProperty,e+"px")}),i.$watch("splitbar."+a.sizeProperties.flowProperty,function(e){t.css(a.sizeProperties.flowProperty,e+"px")}),i.$on("$destroy",function(){n.off("mouseup touchend mousemove touchmove")}),a.addContainer(i.splitbar),t.on("$destroy",function(){a.removeContainer(i.splitbar),i.$evalAsync()})}}}]).directive("uiLayoutContainer",["LayoutContainer","$compile","$timeout","Layout",function(e,n,i,t){return{restrict:"AE",require:"^uiLayout",scope:{collapsed:"=",resizable:"=",size:"@",minSize:"@",maxSize:"@"},compile:function(){return{pre:function(n,i,o,a){n.container=e.Container(),n.container.element=i,n.container.id=i.attr("id")||null,n.container.layoutId=a.id,n.container.isCentral="central"===o.uiLayoutContainer,n.collapsed===!0&&(n.collapsed=!1,t.addCollapsed(n.container)),angular.isDefined(n.resizable)&&(n.container.resizable=n.resizable),n.container.size=n.size,n.container.uncollapsedSize=n.size,n.container.minSize=n.minSize,n.container.maxSize=n.maxSize,a.addContainer(n.container),i.on("$destroy",function(){a.removeContainer(n.container),n.$evalAsync()})},post:function(e,i,t,o){i.hasClass("stretch")||i.addClass("stretch"),i.hasClass("ui-layout-container")||i.addClass("ui-layout-container");var a=o.isUsingColumnFlow?"animate-column":"animate-row";i.addClass(a),e.$watch("collapsed",function(n,i){angular.isDefined(i)&&n!==i&&o.toggleContainer(e.container.index)}),e.$watch("container.size",function(e){i.css(o.sizeProperties.sizeProperty,e+"px"),0===e?i.addClass("ui-layout-hidden"):i.removeClass("ui-layout-hidden")}),e.$watch("container."+o.sizeProperties.flowProperty,function(e){i.css(o.sizeProperties.flowProperty,e+"px")});var s=i.parent(),r=s.children(),l=o.indexOfElement(i),u=angular.element('<div ui-splitbar><a><span class="ui-splitbar-icon"></span></a><a><span class="ui-splitbar-icon"></span></a></div>');l>0&&!o.hasSplitbarBefore(e.container)?(angular.element(r[l-1]).after(u),n(u)(e)):l<r.length-1&&(i.after(u),n(u)(e))}}}}}]).directive("uiLayoutLoaded",["$timeout","Layout",function(e,n){return{require:"^uiLayout",restrict:"A",priority:-100,link:function(e,i,t){t.uiLayoutLoaded?e.$broadcast("ui.layout.loaded",t.uiLayoutLoaded):n.toggle().then(function(){e.$broadcast("ui.layout.loaded",null)})}}}]).factory("Layout",["$q","$timeout",function(e,n){function i(e){try{t[e.layoutId].toggleContainer(e.index)}catch(n){throw n.message="Could not toggle container ["+e.layoutId+"/"+e.index+"]: "+n.message,n}}var t=[],o=[],a=0,s=null;return{addLayout:function(e){e.id=t.length,t.push(e)},addCollapsed:function(e){o.push(e)},hasCollapsed:function(){return o.length>0},toggled:function(){if(0===a){if(!s)return!1;s.reject()}a--,0===a&&s.resolve()},toggle:function(){s=e.defer(),a=o.length,0===a&&n(function(){s.resolve()}),o.reverse();for(var t;t=o.pop();)i(t);return s.promise}}}]).factory("LayoutContainer",function(){function e(){this.id=null,this.layoutId=null,this.isCentral=!1,this.size="auto",this.uncollapsedSize=null,this.maxSize=null,this.minSize=null,this.resizable=!0,this.element=null,this.collapsed=!1}function n(){this.size=10,this.left=0,this.top=0,this.element=null}return{Container:function(n){return new e(n)},Splitbar:function(){return new n},isSplitbar:function(e){return e instanceof n}}});